<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema | ICS Analyzer</title>

  <!-- Bibliotecas para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a5f7a 0%, #2a7fa0 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
    .header { background: linear-gradient(135deg, #1a5f7a 0%, #2a7fa0 100%); color: white; padding: 22px 30px; border-bottom: 4px solid #0d3a47; }
    .header-top { display: flex; justify-content: space-between; gap: 12px; align-items: center; flex-wrap: wrap; }
    .header h1 { font-size: 20px; margin-bottom: 6px; }
    .header p { font-size: 13px; opacity: 0.9; }
    .nav a { color: rgba(255,255,255,0.95); text-decoration: none; font-weight: 600; font-size: 13px; padding: 8px 10px; border-radius: 6px; background: rgba(0,0,0,0.12); }
    .nav a:hover { background: rgba(0,0,0,0.18); }
    .content { padding: 30px; }
    .section { margin-bottom: 30px; }
    .section-title { font-size: 16px; font-weight: 700; color: #1a5f7a; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #2a7fa0; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .form-group { display: flex; flex-direction: column; }
    label { font-weight: 600; margin-bottom: 6px; font-size: 13px; color: #333; }
    input[type="text"], input[type="date"], input[type="time"], input[type="number"], select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
    input:focus, select:focus { outline: none; border-color: #1a5f7a; box-shadow: 0 0 0 2px rgba(26,95,122,0.1); }
    .readings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-bottom: 15px; }
    .reading-input { display: flex; flex-direction: column; }
    .reading-input label { font-size: 12px; color: #666; }
    .reading-input input, .reading-input select { padding: 8px; font-size: 12px; text-align: center; }
    .button-group { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
    button { padding: 12px 24px; border: none; border-radius: 4px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-primary { background: #1a5f7a; color: white; }
    .btn-primary:hover { background: #0d3a47; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(26,95,122,0.3); }
    .btn-success { background: #27ae60; color: white; }
    .btn-success:hover { background: #229954; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(39,174,96,0.3); }
    .btn-secondary { background: #95a5a6; color: white; }
    .btn-secondary:hover { background: #7f8c8d; }
    .results { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 6px; padding: 20px; margin-top: 20px; }
    .results-hidden { display: none; }
    .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .result-box { background: white; border-left: 4px solid #1a5f7a; padding: 15px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .result-label { font-size: 12px; color: #666; font-weight: 600; text-transform: uppercase; margin-bottom: 8px; }
    .result-value { font-size: 28px; font-weight: 700; color: #1a5f7a; }
    .result-unit { font-size: 12px; color: #999; margin-top: 4px; }
    .result-box.success { border-left-color: #27ae60; }
    .readings-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
    .readings-table th { background: #1a5f7a; color: white; padding: 10px; text-align: left; font-weight: 600; }
    .readings-table td { padding: 8px 10px; border-bottom: 1px solid #eee; }
    .readings-table tr:hover { background: #f5f5f5; }
    .hidden { display: none; }
    .message { padding: 15px; border-radius: 4px; margin-bottom: 15px; font-size: 14px; }
    .message.success { background: #d4edda; border: 1px solid #27ae60; color: #155724; }
    .message.error { background: #f8d7da; border: 1px solid #e74c3c; color: #721c24; }

    .section-title-row { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #2a7fa0; }
    .section-title-row .section-title { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
    .help-btn { display: inline-flex; align-items: center; gap: 8px; background: transparent; border: 1px solid rgba(26,95,122,0.25); color: #1a5f7a; padding: 8px 12px; border-radius: 999px; font-size: 13px; font-weight: 700; cursor: pointer; }
    .help-btn:hover { background: rgba(26,95,122,0.06); }
    .help-icon { width: 18px; height: 18px; border-radius: 50%; background: #1a5f7a; color: #fff; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; line-height: 1; }

    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 9999; }
    .modal-backdrop.open { display: flex; }
    .modal { width: 100%; max-width: 760px; background: #fff; border-radius: 10px; box-shadow: 0 12px 48px rgba(0,0,0,0.28); overflow: hidden; }
    .modal-header { background: linear-gradient(135deg, #1a5f7a 0%, #2a7fa0 100%); color: #fff; padding: 14px 18px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .modal-header h3 { font-size: 14px; margin: 0; }
    .modal-close { background: rgba(255,255,255,0.14); border: 1px solid rgba(255,255,255,0.25); color: #fff; border-radius: 8px; padding: 6px 10px; cursor: pointer; font-weight: 700; }
    .modal-body { padding: 18px; font-size: 14px; color: #333; line-height: 1.55; }
    .modal-body ul { margin: 10px 0 0 18px; }
    .modal-sep { border: 0; border-top: 1px solid #e9ecef; margin: 12px 0; }

    .form-hint { font-size: 12px; color: #666; margin-top: 6px; line-height: 1.4; }

    .calc-details { margin-top: 12px; background: #ffffff; border: 1px solid #e9ecef; border-radius: 6px; overflow: hidden; }
    .calc-details summary { cursor: pointer; list-style: none; padding: 12px 14px; font-size: 13px; font-weight: 700; color: #1a5f7a; display: flex; align-items: center; gap: 8px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }
    .calc-details summary::-webkit-details-marker { display: none; }
    .calc-body { padding: 12px 14px; font-size: 12.5px; color: #444; line-height: 1.5; }
    .calc-row { display: flex; flex-wrap: wrap; gap: 6px; margin: 6px 0; }
    .calc-tag { display: inline-block; padding: 2px 8px; border-radius: 999px; background: rgba(26, 95, 122, 0.12); color: #0d3a47; font-weight: 700; font-size: 11px; }
    .calc-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #f3f5f7; border: 1px solid #e5e8eb; border-radius: 4px; padding: 0 6px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-top">
        <div style="display: flex; align-items: center; gap: 15px;">
          <img src="assets/img/logo.png" alt="Logo ICS" style="height: 50px; background: white; padding: 2px; border-radius: 4px;">
          <div>
            <h1>ICS Analyzer</h1>
            <p>√çndice de Cobertura do Solo | Sistema com exporta√ß√£o em PDF</p>
          </div>
        </div>
        <div class="nav">
          <a href="index.html">In√≠cio</a>
          <a href="manual.html">Manual</a>
        </div>
      </div>
    </div>

    <!-- Hidden img for PDF generation convenience -->
    <img id="logo-for-pdf" src="assets/img/logo.png" style="display: none;">

    <div class="content">
      <div class="section">
        <div class="section-title">üìã Dados do Projeto</div>
        <div class="form-grid">
          <div class="form-group">
            <label for="projeto">Nome do Projeto</label>
            <input type="text" id="projeto" placeholder="Ex: Argissolo - Ensaio 2026">
          </div>
          <div class="form-group">
            <label for="local">Local/Fazenda</label>
            <input type="text" id="local" placeholder="Ex: UFS - Campus S√£o Crist√≥v√£o">
          </div>
          <div class="form-group">
            <label for="data">Data da Coleta</label>
            <input type="date" id="data">
          </div>
          <div class="form-group">
            <label for="hora">Hora da Coleta</label>
            <input type="time" id="hora">
          </div>
          <div class="form-group">
            <label for="operador">Operador</label>
            <input type="text" id="operador" placeholder="Nome do t√©cnico">
          </div>
          <div class="form-group">
            <label for="area">Unidade Amostral</label>
            <input type="text" id="area" placeholder="Ex: UA-01">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">‚òÄÔ∏è Condi√ß√µes Ambientais</div>
        <div class="form-grid">
          <div class="form-group">
            <label for="luz">Condi√ß√£o do c√©u / ilumina√ß√£o</label>
            <select id="luz">
              <option value="">--Selecione--</option>
              <option value="C√©u limpo (sol direto)">C√©u limpo (sol direto)</option>
              <option value="Parcialmente nublado">Parcialmente nublado</option>
              <option value="Nublado">Nublado</option>
              <option value="Encoberto (sem sol direto)">Encoberto (sem sol direto)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sombra">Sombra no ret√≠culo/√°rea</label>
            <select id="sombra">
              <option value="">--Selecione--</option>
              <option value="Sem sombra (sol direto)">Sem sombra (sol direto)</option>
              <option value="Sombra parcial">Sombra parcial</option>
              <option value="Sombra predominante">Sombra predominante</option>
            </select>
          </div>
          <div class="form-group">
            <label for="vento">Vento</label>
            <select id="vento">
              <option value="">--Selecione--</option>
              <option value="Calmo (<1 m/s)">Calmo (&lt;1 m/s)</option>
              <option value="Leve (1-3 m/s)">Leve (1-3 m/s)</option>
              <option value="Moderado (3-6 m/s)">Moderado (3-6 m/s)</option>
              <option value="Forte (>6 m/s)">Forte (&gt;6 m/s)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="precip">Precipita√ß√£o no momento</label>
            <select id="precip">
              <option value="">--Selecione--</option>
              <option value="Sem precipita√ß√£o">Sem precipita√ß√£o</option>
              <option value="Chuvisco">Chuvisco</option>
              <option value="Chuva">Chuva</option>
              <option value="Neblina/nevoeiro">Neblina/nevoeiro</option>
            </select>
          </div>
          <div class="form-group">
            <label for="chuva">Precipita√ß√£o recente</label>
            <select id="chuva">
              <option value="">--Selecione--</option>
              <option value="N√£o">N√£o</option>
              <option value="Sim (<24h)">Sim (&lt;24h)</option>
              <option value="Sim (1-3 dias)">Sim (1-3 dias)</option>
              <option value="Sim (>3 dias)">Sim (&gt;3 dias)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="umidade">Umidade superficial do solo/res√≠duo</label>
            <select id="umidade">
              <option value="">--Selecione--</option>
              <option value="Seco">Seco</option>
              <option value="√ömido (sem brilho)">√ömido (sem brilho)</option>
              <option value="Molhado (com brilho)">Molhado (com brilho)</option>
              <option value="Encharcado">Encharcado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="notas">Observa√ß√µes</label>
            <input type="text" id="notas" placeholder="Anota√ß√µes adicionais">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">üìê Calibra√ß√£o do Campo Visual (opcional)</div>
        <div class="form-grid">
          <div class="form-group">
            <label for="distVisada">Dist√¢ncia de visada (D)</label>
            <input type="number" id="distVisada" min="0" step="0.1" placeholder="Ex: 200">
            <div class="form-hint">Use quando a campanha exige dist√¢ncia fixa. A √°rea depende da geometria do campo; a dist√¢ncia ajuda na rastreabilidade do ensaio.</div>
          </div>
          <div class="form-group">
            <label for="campoModo">Geometria do campo (na dist√¢ncia D)</label>
            <select id="campoModo">
              <option value="">--N√£o informar--</option>
              <option value="retangular">Retangular (informar largura e altura)</option>
            </select>
            <div class="form-hint">Se n√£o preencher, o sistema calcula apenas ICS e % (sem m¬≤).</div>
          </div>
          <div class="form-group" id="grpCampoLargura">
            <label for="campoLargura">Largura do campo (W, m)</label>
            <input type="number" id="campoLargura" min="0" step="0.01" placeholder="Ex: 3.60">
          </div>
          <div class="form-group" id="grpCampoAltura">
            <label for="campoAltura">Altura do campo (H, m)</label>
            <input type="number" id="campoAltura" min="0" step="0.01" placeholder="Ex: 3.60">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title-row">
          <div class="section-title">üìè Leituras do √çndice de Cobertura (0.00 a 1.00)</div>
          <button type="button" class="help-btn" id="btnAjudaLeituras" aria-haspopup="dialog" aria-controls="ajudaModal">
            <span class="help-icon">!</span>
            Como usar o aparato
          </button>
        </div>
        <div class="form-group">
          <label for="numLeituras">N√∫mero de Leituras</label>
          <select id="numLeituras">
            <option value="8">8 leituras</option>
            <option value="16" selected>16 leituras</option>
            <option value="24">24 leituras</option>
            <option value="32">32 leituras</option>
          </select>
        </div>
        <div class="readings-grid" id="readings-container"></div>
      </div>

      <div class="button-group">
        <button class="btn-primary" id="btnCalcular">üî¢ Calcular Resultados</button>
        <button class="btn-success" id="btnExportarPDF">üìÑ Exportar como PDF</button>
        <button class="btn-secondary" id="btnLimpar">üîÑ Limpar Dados</button>
      </div>

      <div id="mensagem" class="hidden message"></div>

      <div id="results" class="results results-hidden">
        <div class="section-title">üìä Resultados da An√°lise</div>

        <div class="result-grid">
          <div class="result-box success">
            <div class="result-label">M√©dia (ICS)</div>
            <div class="result-value" id="media">0.000</div>
            <div class="result-unit">(classe 0.00-1.00)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Percentual de Cobertura</div>
            <div class="result-value" id="percentual">0.0%</div>
            <div class="result-unit">(0-100%)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Desvio Padr√£o</div>
            <div class="result-value" id="desvio">0.000</div>
            <div class="result-unit">(œÉ)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Coeficiente de Varia√ß√£o</div>
            <div class="result-value" id="cv">0.0%</div>
            <div class="result-unit">(CV%)</div>
          </div>
        </div>

        <details class="calc-details">
          <summary>üßÆ Como foi calculado</summary>
          <div class="calc-body">
            <div class="calc-row">
              <span class="calc-tag">ICSÃÑ</span>
              <span>=</span>
              <span class="calc-mono">Œ£ ICS·µ¢ / n</span>
              <span>=</span>
              <span class="calc-mono"><span id="calc-soma">0.000</span> / <span id="calc-n">0</span></span>
              <span>=</span>
              <span class="calc-mono"><span id="calc-ics">0.000</span></span>
            </div>
            <div class="calc-row">
              <span class="calc-tag">% Cobertura</span>
              <span>=</span>
              <span class="calc-mono">100 √ó ICSÃÑ</span>
              <span>=</span>
              <span class="calc-mono">100 √ó <span id="calc-ics2">0.000</span></span>
              <span>=</span>
              <span class="calc-mono"><span id="calc-pct">0.0%</span></span>
            </div>
            <div class="calc-row">
              <span class="calc-tag">Equival√™ncia (patente)</span>
              <span class="calc-mono">Se ICS·µ¢ = At·µ¢/A_campo, ent√£o % = 100 √ó (Œ£At·µ¢)/(n¬∑A_campo) = 100 √ó (Œ£ICS·µ¢)/n</span>
            </div>
          </div>
        </details>

        <div id="area-results" class="result-grid hidden">
          <div class="result-box">
            <div class="result-label">√Årea do campo (A_campo)</div>
            <div class="result-value" id="area-campo">0.00</div>
            <div class="result-unit">m¬≤</div>
          </div>
          <div class="result-box">
            <div class="result-label">√Årea coberta m√©dia</div>
            <div class="result-value" id="area-coberta-media">0.00</div>
            <div class="result-unit">m¬≤ (ICSÃÑ √ó A_campo)</div>
          </div>
          <div class="result-box">
            <div class="result-label">√Årea coberta total</div>
            <div class="result-value" id="area-coberta-total">0.00</div>
            <div class="result-unit">m¬≤ (Œ£At·µ¢)</div>
          </div>
        </div>

        <div class="result-grid">
          <div class="result-box">
            <div class="result-label">Classifica√ß√£o</div>
            <div class="result-value" id="classe">-</div>
            <div class="result-unit" id="classe-desc">Aguardando c√°lculo</div>
          </div>
          <div class="result-box">
            <div class="result-label">Amplitude (Range)</div>
            <div class="result-value" id="amplitude">0.000</div>
            <div class="result-unit">(Max-Min)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Valor M√≠nimo</div>
            <div class="result-value" id="minimo">0.000</div>
          </div>
          <div class="result-box">
            <div class="result-label">Valor M√°ximo</div>
            <div class="result-value" id="maximo">1.000</div>
          </div>
        </div>

        <table class="readings-table">
          <thead>
            <tr>
              <th>Leitura #</th>
              <th>Valor ICS</th>
              <th>Percentual</th>
              <th>Classifica√ß√£o</th>
            </tr>
          </thead>
          <tbody id="readings-table-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="ajudaModal" role="dialog" aria-modal="true" aria-labelledby="ajudaTitulo" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="ajudaTitulo">Como capturar a leitura no ret√≠culo (ICS)</h3>
        <button class="modal-close" id="btnFecharAjuda" type="button">Fechar</button>
      </div>
      <div class="modal-body">
        <p><strong>O que voc√™ registra:</strong> em cada ponto voc√™ escolhe uma classe (<span class="calc-mono">0.0</span>, <span class="calc-mono">0.2</span>, <span class="calc-mono">0.4</span>, <span class="calc-mono">0.6</span>, <span class="calc-mono">0.8</span>, <span class="calc-mono">1.0</span>) que representa a fra√ß√£o do campo visual ocupada por cobertura (vegeta√ß√£o/palhada) em rela√ß√£o ao solo exposto.</p>

        <p><strong>Como olhar no ret√≠culo (horizontal e vertical):</strong></p>
        <ul>
          <li>Centralize o olho na ocular e mantenha o aparelho est√°vel (evite paralaxe e ‚Äúvarredura‚Äù).</li>
          <li>Enquadre o ponto de leitura no campo visual do ret√≠culo.</li>
          <li>Fa√ßa duas estimativas r√°pidas: linha horizontal (largura coberta) e linha vertical (altura coberta).</li>
          <li>Se as estimativas forem parecidas, use esse valor. Se divergirem, fa√ßa uma m√©dia mental e selecione a classe mais pr√≥xima.</li>
        </ul>

        <p><strong>Classes (fra√ß√µes) para escolher:</strong></p>
        <ul>
          <li><span class="calc-mono">0.0</span> = 0% (solo exposto / cobertura desprez√≠vel)</li>
          <li><span class="calc-mono">0.2</span> = 20% do campo coberto</li>
          <li><span class="calc-mono">0.4</span> = 40% do campo coberto</li>
          <li><span class="calc-mono">0.6</span> = 60% do campo coberto</li>
          <li><span class="calc-mono">0.8</span> = 80% do campo coberto</li>
          <li><span class="calc-mono">1.0</span> = 100% (campo praticamente todo coberto)</li>
        </ul>

        <p><strong>Regra pr√°tica de d√∫vida:</strong> se estiver entre duas classes, escolha a menor (conservadora) e anote a condi√ß√£o (sombra/chuva/vento) nas observa√ß√µes.</p>
        <p><strong>No sistema:</strong> selecione a classe em L1‚Ä¶Ln imediatamente ap√≥s cada visada.</p>

  <hr class="modal-sep">

        <p><strong>Para obter resultados em m¬≤:</strong> preencha a se√ß√£o ‚ÄúCalibra√ß√£o do Campo Visual‚Äù (dist√¢ncia D e geometria do campo). O sistema calcula automaticamente <span class="calc-mono">A_campo</span> e as √°reas cobertas (<span class="calc-mono">At_i = ICS_i x A_campo</span>, <span class="calc-mono">soma(At_i)</span>).</p>
      </div>
    </div>
  </div>

  <script src="assets/js/ics_analyzer_pdf.js" defer></script>
</body>
</html>
