<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema | ICS Analyzer</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <!-- Bibliotecas para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header class="header">
      <div class="header-top">
        <div style="display: flex; align-items: center; gap: 15px;">
          <img src="assets/img/logo.png" alt="Logo ICS" style="height: 50px; background: rgba(255, 255, 255, 0); padding: 2px; border-radius: 4px;">
          <div>
            <h1>ICS Analyzer</h1>
            <p>√çndice de Cobertura do Solo | Sistema com exporta√ß√£o em PDF</p>
          </div>
        </div>
        <nav class="nav">
          <a href="index.html">In√≠cio</a>
          <a href="manual.html">Manual</a>
        </nav>
      </div>
    </header>

    <!-- Hidden img for PDF generation convenience -->
    <img id="logo-for-pdf" src="assets/img/logo.png" style="display: none;">

    <main class="main-wrapper">
      <div class="section">
        <div class="section-title">üìã Dados do Projeto</div>
        <div class="form-grid">
          <div class="form-group">
            <label for="projeto">Nome do Projeto</label>
            <input type="text" id="projeto" placeholder="Ex: Argissolo - Ensaio 2026">
          </div>
          <div class="form-group">
            <label for="local">Local/Fazenda</label>
            <input type="text" id="local" placeholder="Ex: UFS - Campus S√£o Crist√≥v√£o">
          </div>
          <div class="form-group">
            <label for="data">Data da Coleta</label>
            <input type="date" id="data">
          </div>
          <div class="form-group">
            <label for="hora">Hora da Coleta</label>
            <input type="time" id="hora">
          </div>
          <div class="form-group">
            <label for="operador">Operador</label>
            <input type="text" id="operador" placeholder="Nome do t√©cnico">
          </div>
          <div class="form-group">
            <label for="area">Unidade Amostral</label>
            <input type="text" id="area" placeholder="Ex: UA-01">
          </div>
          <div class="form-group" style="grid-column: span 2;">
            <label for="inputCroqui">Foto/Croqui da √Årea (Opcional)</label>
            <input type="file" id="inputCroqui" accept="image/*" style="padding: 6px;">
            <div class="form-hint">A imagem ser√° inclu√≠da no final do relat√≥rio PDF. Formato recomendado: JPG/PNG.</div>
            <img id="previewCroqui" style="max-height: 100px; margin-top: 10px; display: none; border: 1px solid #ddd; padding: 2px;" alt="Pr√©-visualiza√ß√£o">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">‚òÄÔ∏è Condi√ß√µes Ambientais</div>
        <div class="form-grid">
          <div class="form-group">
            <label for="luz">Condi√ß√£o do c√©u / ilumina√ß√£o</label>
            <select id="luz">
              <option value="">--Selecione--</option>
              <option value="C√©u limpo (sol direto)">C√©u limpo (sol direto)</option>
              <option value="Parcialmente nublado">Parcialmente nublado</option>
              <option value="Nublado">Nublado</option>
              <option value="Encoberto (sem sol direto)">Encoberto (sem sol direto)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sombra">Sombra no ret√≠culo/√°rea</label>
            <select id="sombra">
              <option value="">--Selecione--</option>
              <option value="Sem sombra (sol direto)">Sem sombra (sol direto)</option>
              <option value="Sombra parcial">Sombra parcial</option>
              <option value="Sombra predominante">Sombra predominante</option>
            </select>
          </div>
          <div class="form-group">
            <label for="vento">Vento</label>
            <select id="vento">
              <option value="">--Selecione--</option>
              <option value="Calmo (<1 m/s)">Calmo (&lt;1 m/s)</option>
              <option value="Leve (1-3 m/s)">Leve (1-3 m/s)</option>
              <option value="Moderado (3-6 m/s)">Moderado (3-6 m/s)</option>
              <option value="Forte (>6 m/s)">Forte (&gt;6 m/s)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="precip">Precipita√ß√£o no momento</label>
            <select id="precip">
              <option value="">--Selecione--</option>
              <option value="Sem precipita√ß√£o">Sem precipita√ß√£o</option>
              <option value="Chuvisco">Chuvisco</option>
              <option value="Chuva">Chuva</option>
              <option value="Neblina/nevoeiro">Neblina/nevoeiro</option>
            </select>
          </div>
          <div class="form-group">
            <label for="chuva">Precipita√ß√£o recente</label>
            <select id="chuva">
              <option value="">--Selecione--</option>
              <option value="N√£o">N√£o</option>
              <option value="Sim (<24h)">Sim (&lt;24h)</option>
              <option value="Sim (1-3 dias)">Sim (1-3 dias)</option>
              <option value="Sim (>3 dias)">Sim (&gt;3 dias)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="umidade">Umidade superficial do solo/res√≠duo</label>
            <select id="umidade">
              <option value="">--Selecione--</option>
              <option value="Seco">Seco</option>
              <option value="√ömido (sem brilho)">√ömido (sem brilho)</option>
              <option value="Molhado (com brilho)">Molhado (com brilho)</option>
              <option value="Encharcado">Encharcado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="notas">Observa√ß√µes</label>
            <input type="text" id="notas" placeholder="Anota√ß√µes adicionais">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">üìê Calibra√ß√£o do Campo Visual (opcional)</div>
        <div class="form-grid">
          <div class="form-group">
            <label for="distVisada">Dist√¢ncia de visada (D)</label>
            <input type="number" id="distVisada" min="0" step="0.1" placeholder="Ex: 200">
            <div class="form-hint">Use quando a campanha exige dist√¢ncia fixa. A √°rea depende da geometria do campo; a dist√¢ncia ajuda na rastreabilidade do ensaio.</div>
          </div>
          <div class="form-group">
            <label for="campoModo">Geometria do campo (na dist√¢ncia D)</label>
            <select id="campoModo">
              <option value="">--N√£o informar--</option>
              <option value="retangular">Retangular (informar largura e altura)</option>
            </select>
            <div class="form-hint">Se n√£o preencher, o sistema calcula apenas ICS e % (sem m¬≤).</div>
          </div>
          <div class="form-group" id="grpCampoLargura">
            <label for="campoLargura">Largura do campo (W, m)</label>
            <input type="number" id="campoLargura" min="0" step="0.01" placeholder="Ex: 3.60">
          </div>
          <div class="form-group" id="grpCampoAltura">
            <label for="campoAltura">Altura do campo (H, m)</label>
            <input type="number" id="campoAltura" min="0" step="0.01" placeholder="Ex: 3.60">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title-row">
          <div class="section-title">üìè Leituras do √çndice de Cobertura (0.00 a 1.00)</div>
          <button type="button" class="help-btn" id="btnAjudaLeituras" aria-haspopup="dialog" aria-controls="ajudaModal">
            <span class="help-icon">!</span>
            Como usar o aparato
          </button>
        </div>
        <div class="form-group">
          <label for="numLeituras">N√∫mero de Leituras</label>
          <select id="numLeituras">
            <option value="8">8 leituras</option>
            <option value="16" selected>16 leituras</option>
            <option value="24">24 leituras</option>
            <option value="32">32 leituras</option>
          </select>
        </div>
        <div class="readings-grid" id="readings-container"></div>
      </div>

      <div class="button-group">
        <button type="button" class="btn-primary" id="btnCalcular">üî¢ Calcular Resultados</button>
        <button type="button" class="btn-success" id="btnExportarPDF">üìÑ Exportar como PDF</button>
        <button type="button" class="btn-secondary" id="btnLimpar">üîÑ Limpar Dados</button>
      </div>

      <div id="mensagem" class="hidden message"></div>

      <div id="results" class="results results-hidden">
        <div class="section-title">üìä Resultados da An√°lise</div>

        <div class="result-grid">
          <div class="result-box success">
            <div class="result-label">M√©dia (ICS)</div>
            <div class="result-value" id="media">0.000</div>
            <div class="result-unit">(classe 0.00-1.00)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Percentual de Cobertura</div>
            <div class="result-value" id="percentual">0.0%</div>
            <div class="result-unit">(0-100%)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Desvio Padr√£o</div>
            <div class="result-value" id="desvio">0.000</div>
            <div class="result-unit">(œÉ)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Coeficiente de Varia√ß√£o</div>
            <div class="result-value" id="cv">0.0%</div>
            <div class="result-unit">(CV%)</div>
          </div>
        </div>

        <details class="calc-details">
          <summary>üßÆ Como foi calculado</summary>
          <div class="calc-body">
            <div class="calc-row">
              <span class="calc-tag">ICS ponto</span>
              <span>=</span>
              <span class="calc-mono">( Horizontal + (Vertical / 2) ) / 2</span>
            </div>
            <div class="calc-row">
              <span class="calc-tag">ICSÃÑ (M√©dia)</span>
              <span>=</span>
              <span class="calc-mono">Œ£ ICS pontos / n</span>
              <span>=</span>
              <span class="calc-mono"><span id="calc-soma">0.000</span> / <span id="calc-n">0</span></span>
              <span>=</span>
              <span class="calc-mono"><span id="calc-ics">0.000</span></span>
            </div>
            <div class="calc-row">
              <span class="calc-tag">% Cobertura</span>
              <span>=</span>
              <span class="calc-mono">100 √ó ICSÃÑ</span>
              <span>=</span>
              <span class="calc-mono">100 √ó <span id="calc-ics2">0.000</span></span>
              <span>=</span>
              <span class="calc-mono"><span id="calc-pct">0.0%</span></span>
            </div>
            <div class="calc-row">
              <span class="calc-tag">Equival√™ncia (patente)</span>
              <span class="calc-mono">Se ICS·µ¢ = At·µ¢/A_campo, ent√£o % = 100 √ó (Œ£At·µ¢)/(n¬∑A_campo) = 100 √ó (Œ£ICS·µ¢)/n</span>
            </div>
          </div>
        </details>

        <div id="area-results" class="result-grid hidden">
          <div class="result-box">
            <div class="result-label">√Årea do campo (A_campo)</div>
            <div class="result-value" id="area-campo">0.00</div>
            <div class="result-unit">m¬≤</div>
          </div>
          <div class="result-box">
            <div class="result-label">√Årea coberta m√©dia</div>
            <div class="result-value" id="area-coberta-media">0.00</div>
            <div class="result-unit">m¬≤ (ICSÃÑ √ó A_campo)</div>
          </div>
          <div class="result-box">
            <div class="result-label">√Årea coberta total</div>
            <div class="result-value" id="area-coberta-total">0.00</div>
            <div class="result-unit">m¬≤ (Œ£At·µ¢)</div>
          </div>
        </div>

        <div class="result-grid">
          <div class="result-box">
            <div class="result-label">Classifica√ß√£o</div>
            <div class="result-value" id="classe">-</div>
            <div class="result-unit" id="classe-desc">Aguardando c√°lculo</div>
          </div>
          <div class="result-box">
            <div class="result-label">Amplitude (Range)</div>
            <div class="result-value" id="amplitude">0.000</div>
            <div class="result-unit">(Max-Min)</div>
          </div>
          <div class="result-box">
            <div class="result-label">Valor M√≠nimo</div>
            <div class="result-value" id="minimo">0.000</div>
          </div>
          <div class="result-box">
            <div class="result-label">Valor M√°ximo</div>
            <div class="result-value" id="maximo">1.000</div>
          </div>
        </div>

        <table class="readings-table">
          <thead>
            <tr>
              <th>Leitura #</th>
              <th>Valor ICS</th>
              <th>Percentual</th>
              <th>Classifica√ß√£o</th>
            </tr>
          </thead>
          <tbody id="readings-table-body"></tbody>
        </table>
      </div>
    </main>

  <div class="modal-backdrop" id="ajudaModal" role="dialog" aria-modal="true" aria-labelledby="ajudaTitulo" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="ajudaTitulo">Como capturar a leitura no ret√≠culo (ICS)</h3>
        <button class="modal-close" id="btnFecharAjuda" type="button">Fechar</button>
      </div>
      <div class="modal-body">
        <p><strong>O que voc√™ registra:</strong> em cada ponto voc√™ escolhe uma classe (<span class="calc-mono">0.0</span>, <span class="calc-mono">0.2</span>, <span class="calc-mono">0.4</span>, <span class="calc-mono">0.6</span>, <span class="calc-mono">0.8</span>, <span class="calc-mono">1.0</span>) que representa a fra√ß√£o do campo visual ocupada por cobertura (vegeta√ß√£o/palhada) em rela√ß√£o ao solo exposto.</p>

        <p><strong>Posicionamento do Operador:</strong></p>
        <div style="text-align: center; margin: 15px 0;">
          <img src="assets/img/aparato_exemplo.png" alt="Posicionamento do Operador" style="max-width: 100%; height: auto; max-height: 200px; border: 1px solid #ddd; border-radius: 4px; padding: 4px;">
          <p style="font-size: 11px; color: #666; margin-top: 5px;">Exemplo de uso do aparato em campo</p>
        </div>

        <p><strong>Como olhar no ret√≠culo (horizontal e vertical):</strong></p>
        
        <div style="text-align: center; margin: 15px 0;">
          <img src="assets/img/figura_reticulo_explicacao.png" alt="Exemplo de Leitura no Ret√≠culo" style="max-width: 100%; height: auto; max-height: 250px; border: 1px solid #ddd; border-radius: 4px; padding: 4px;">
          <p style="font-size: 11px; color: #666; margin-top: 5px;">Figura ilustrativa: Identifica√ß√£o das linhas de leitura no ret√≠culo</p>
        </div>

        <ul>
          <li><strong>Leitura Horizontal (H):</strong> Observe apenas a linha horizontal do ret√≠culo. Estime quanto dessa linha est√° sobrepondo material vegetal (cobertura).</li>
          <li><strong>Leitura Vertical (V):</strong> Observe apenas a linha vertical do ret√≠culo. Estime quanto dessa linha est√° sobrepondo material vegetal.</li>
          <li>Centralize o olho e evite paralaxe. Fa√ßa as duas leituras de forma independente.</li>
          <li>No c√°lculo do sistema, a leitura do ponto √© combinada como <span class="calc-mono">ICS_i = H_i &times; V_i</span>, aproximando a fra√ß√£o de √°rea coberta a partir das fra√ß√µes ortogonais observadas no ret√≠culo.</li>
        </ul>

        <p><strong>Classes (fra√ß√µes) para escolher:</strong></p>
        <ul>
          <li><span class="calc-mono">0.0</span> = 0% (solo exposto / cobertura desprez√≠vel)</li>
          <li><span class="calc-mono">0.2</span> = 20% do campo coberto</li>
          <li><span class="calc-mono">0.4</span> = 40% do campo coberto</li>
          <li><span class="calc-mono">0.6</span> = 60% do campo coberto</li>
          <li><span class="calc-mono">0.8</span> = 80% do campo coberto</li>
          <li><span class="calc-mono">1.0</span> = 100% (campo praticamente todo coberto)</li>
        </ul>

        <p><strong>Regra pr√°tica de d√∫vida:</strong> se estiver entre duas classes, escolha a menor (conservadora) e anote a condi√ß√£o (sombra/chuva/vento) nas observa√ß√µes.</p>
        <p><strong>No sistema:</strong> selecione a classe em L1‚Ä¶Ln imediatamente ap√≥s cada visada.</p>

  <hr class="modal-sep">

        <p><strong>Para obter resultados em m¬≤:</strong> preencha a se√ß√£o ‚ÄúCalibra√ß√£o do Campo Visual‚Äù (dist√¢ncia D e geometria do campo). O sistema calcula automaticamente <span class="calc-mono">A_campo</span> e as √°reas cobertas (<span class="calc-mono">At_i = ICS_i x A_campo</span>, <span class="calc-mono">soma(At_i)</span>).</p>
      </div>
    </div>
  </div>

  <script src="assets/js/ics_analyzer_pdf.js" defer></script>
</body>
</html>
